description: Network Service Descriptor (Final Version)
imports:
- etsi_nfv_sol001_nsd_types.yaml
- VNF1-scalable.yaml
- VNF2-scalable.yaml
- CNF3-scalable.yaml
topology_template:
  node_templates:
    cnf_instance:
      properties:
        flavour_id: scalable_ha_container
      requirements:
      - virtual_link: vl_data_network
      - virtual_link_external: vl_mgmt_network
      type: tosca.nodes.nfv.Proxy_CNF
    sap_data:
      properties:
        layer_protocols:
        - ipv4
        role: root
      requirements:
      - internal_virtual_link: vl_data_network
      type: tosca.nodes.nfv.Sap
    sap_mgmt:
      properties:
        layer_protocols:
        - ipv4
        role: root
      requirements:
      - internal_virtual_link: vl_mgmt_network
      type: tosca.nodes.nfv.Sap
    vl_data_network:
      properties:
        connectivity_type:
          flow_pattern: line
          layer_protocols:
          - ipv4
        vl_profile:
          max_bitrate_requirements:
            root: 10000000
          min_bitrate_requirements:
            root: 1000000
      type: tosca.nodes.nfv.NsVirtualLink
    vl_mgmt_network:
      properties:
        connectivity_type:
          flow_pattern: mesh
          layer_protocols:
          - ipv4
        vl_profile:
          max_bitrate_requirements:
            root: 1000000
          min_bitrate_requirements:
            root: 100000
      type: tosca.nodes.nfv.NsVirtualLink
    vnf1_instance:
      properties:
        flavour_id: scalable_ha
      requirements:
      - virtual_link: vl_mgmt_network
      - virtual_link_external: vl_mgmt_network
      type: tosca.nodes.nfv.Firewall_VNF
    vnf2_instance:
      properties:
        flavour_id: scalable_ha
      requirements:
      - virtual_link: vl_data_network
      - virtual_link_external: vl_mgmt_network
      type: tosca.nodes.nfv.IDS_VNF
  policies:
  - ns_instantiation_levels:
      properties:
        default_level: small
        ns_levels:
          large:
            description: "D\xE9ploiement haute performance"
          medium:
            description: "D\xE9ploiement moyen"
          small:
            description: "D\xE9ploiement minimal"
      type: tosca.policies.nfv.NsInstantiationLevels
  - vnf1_mapping:
      properties:
        aspect: ns_scaling_aspect
        number_of_instances:
          large: 3
          medium: 2
          small: 1
      targets:
      - vnf1_instance
      type: tosca.policies.nfv.VnfToLevelMapping
  - vnf2_mapping:
      properties:
        aspect: ns_scaling_aspect
        number_of_instances:
          large: 3
          medium: 2
          small: 1
      targets:
      - vnf2_instance
      type: tosca.policies.nfv.VnfToLevelMapping
  - cnf_mapping:
      properties:
        aspect: ns_scaling_aspect
        number_of_instances:
          large: 3
          medium: 2
          small: 1
      targets:
      - cnf_instance
      type: tosca.policies.nfv.VnfToLevelMapping
  - ns_scaling_aspects:
      properties:
        aspects:
          ns_scaling_aspect:
            description: Scaling horizontal
            name: ns_scaling_aspect
            ns_scale_levels:
              0:
                description: Base
              1:
                description: Niveau 1
              2:
                description: Niveau 2
              3:
                description: Maximum
      type: tosca.policies.nfv.NsScalingAspects
  workflows:
    declarative_deploy:
      description: Deployment declarative workflow
      steps:
        configure_cnf_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_cnf_instance
          target: cnf_instance
        configure_sap_data:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_sap_data
          target: sap_data
        configure_sap_mgmt:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_sap_mgmt
          target: sap_mgmt
        configure_vl_data_network:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vl_data_network
          target: vl_data_network
        configure_vl_mgmt_network:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vl_mgmt_network
          target: vl_mgmt_network
        configure_vnf1_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vnf1_instance
          target: vnf1_instance
        configure_vnf2_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vnf2_instance
          target: vnf2_instance
        create_cnf_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_cnf_instance
          target: cnf_instance
        create_sap_data:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_sap_data
          target: sap_data
        create_sap_mgmt:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_sap_mgmt
          target: sap_mgmt
        create_vl_data_network:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vl_data_network
          target: vl_data_network
        create_vl_mgmt_network:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vl_mgmt_network
          target: vl_mgmt_network
        create_vnf1_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vnf1_instance
          target: vnf1_instance
        create_vnf2_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vnf2_instance
          target: vnf2_instance
        post_configure_cnf_instance:
          activities:
          - set_state: configured
          on_success:
          - start_cnf_instance
          target: cnf_instance
        post_configure_sap_data:
          activities:
          - set_state: configured
          on_success:
          - start_sap_data
          target: sap_data
        post_configure_sap_mgmt:
          activities:
          - set_state: configured
          on_success:
          - start_sap_mgmt
          target: sap_mgmt
        post_configure_vl_data_network:
          activities:
          - set_state: configured
          on_success:
          - start_vl_data_network
          target: vl_data_network
        post_configure_vl_mgmt_network:
          activities:
          - set_state: configured
          on_success:
          - start_vl_mgmt_network
          target: vl_mgmt_network
        post_configure_vnf1_instance:
          activities:
          - set_state: configured
          on_success:
          - start_vnf1_instance
          target: vnf1_instance
        post_configure_vnf2_instance:
          activities:
          - set_state: configured
          on_success:
          - start_vnf2_instance
          target: vnf2_instance
        pre_configure_cnf_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_cnf_instance
          target: cnf_instance
        pre_configure_sap_data:
          activities:
          - set_state: configuring
          on_success:
          - configure_sap_data
          target: sap_data
        pre_configure_sap_mgmt:
          activities:
          - set_state: configuring
          on_success:
          - configure_sap_mgmt
          target: sap_mgmt
        pre_configure_vl_data_network:
          activities:
          - set_state: configuring
          on_success:
          - configure_vl_data_network
          target: vl_data_network
        pre_configure_vl_mgmt_network:
          activities:
          - set_state: configuring
          on_success:
          - configure_vl_mgmt_network
          target: vl_mgmt_network
        pre_configure_vnf1_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_vnf1_instance
          target: vnf1_instance
        pre_configure_vnf2_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_vnf2_instance
          target: vnf2_instance
        start_cnf_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: cnf_instance
        start_sap_data:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: sap_data
        start_sap_mgmt:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: sap_mgmt
        start_vl_data_network:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          on_success:
          - create_vnf2_instance
          - create_cnf_instance
          - create_sap_data
          target: vl_data_network
        start_vl_mgmt_network:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          on_success:
          - create_vnf1_instance
          - create_vnf2_instance
          - create_cnf_instance
          - create_sap_mgmt
          target: vl_mgmt_network
        start_vnf1_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: vnf1_instance
        start_vnf2_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: vnf2_instance
    declarative_undeploy:
      description: Undeployment declarative workflow
      steps:
        delete_cnf_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          - stop_vl_mgmt_network
          target: cnf_instance
        delete_sap_data:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          target: sap_data
        delete_sap_mgmt:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_mgmt_network
          target: sap_mgmt
        delete_vl_data_network:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          target: vl_data_network
        delete_vl_mgmt_network:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          target: vl_mgmt_network
        delete_vnf1_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_mgmt_network
          target: vnf1_instance
        delete_vnf2_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          - stop_vl_mgmt_network
          target: vnf2_instance
        stop_cnf_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_cnf_instance
          target: cnf_instance
        stop_sap_data:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_sap_data
          target: sap_data
        stop_sap_mgmt:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_sap_mgmt
          target: sap_mgmt
        stop_vl_data_network:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vl_data_network
          target: vl_data_network
        stop_vl_mgmt_network:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vl_mgmt_network
          target: vl_mgmt_network
        stop_vnf1_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vnf1_instance
          target: vnf1_instance
        stop_vnf2_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vnf2_instance
          target: vnf2_instance
    parallel_deploy:
      description: Parallel deployment declarative workflow
      steps:
        configure_cnf_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_cnf_instance
          target: cnf_instance
        configure_sap_data:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_sap_data
          target: sap_data
        configure_sap_mgmt:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_sap_mgmt
          target: sap_mgmt
        configure_vl_data_network:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vl_data_network
          target: vl_data_network
        configure_vl_mgmt_network:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vl_mgmt_network
          target: vl_mgmt_network
        configure_vnf1_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vnf1_instance
          target: vnf1_instance
        configure_vnf2_instance:
          activities:
          - call_operation: Standard.configure
          on_success:
          - post_configure_vnf2_instance
          target: vnf2_instance
        create_cnf_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_cnf_instance
          target: cnf_instance
        create_sap_data:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_sap_data
          target: sap_data
        create_sap_mgmt:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_sap_mgmt
          target: sap_mgmt
        create_vl_data_network:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vl_data_network
          target: vl_data_network
        create_vl_mgmt_network:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vl_mgmt_network
          target: vl_mgmt_network
        create_vnf1_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vnf1_instance
          target: vnf1_instance
        create_vnf2_instance:
          activities:
          - set_state: creating
          - call_operation: Standard.create
          - set_state: created
          on_success:
          - pre_configure_vnf2_instance
          target: vnf2_instance
        post_configure_cnf_instance:
          activities:
          - set_state: configured
          on_success:
          - start_cnf_instance
          target: cnf_instance
        post_configure_sap_data:
          activities:
          - set_state: configured
          on_success:
          - start_sap_data
          target: sap_data
        post_configure_sap_mgmt:
          activities:
          - set_state: configured
          on_success:
          - start_sap_mgmt
          target: sap_mgmt
        post_configure_vl_data_network:
          activities:
          - set_state: configured
          on_success:
          - start_vl_data_network
          target: vl_data_network
        post_configure_vl_mgmt_network:
          activities:
          - set_state: configured
          on_success:
          - start_vl_mgmt_network
          target: vl_mgmt_network
        post_configure_vnf1_instance:
          activities:
          - set_state: configured
          on_success:
          - start_vnf1_instance
          target: vnf1_instance
        post_configure_vnf2_instance:
          activities:
          - set_state: configured
          on_success:
          - start_vnf2_instance
          target: vnf2_instance
        pre_configure_cnf_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_cnf_instance
          target: cnf_instance
        pre_configure_sap_data:
          activities:
          - set_state: configuring
          on_success:
          - configure_sap_data
          target: sap_data
        pre_configure_sap_mgmt:
          activities:
          - set_state: configuring
          on_success:
          - configure_sap_mgmt
          target: sap_mgmt
        pre_configure_vl_data_network:
          activities:
          - set_state: configuring
          on_success:
          - configure_vl_data_network
          target: vl_data_network
        pre_configure_vl_mgmt_network:
          activities:
          - set_state: configuring
          on_success:
          - configure_vl_mgmt_network
          target: vl_mgmt_network
        pre_configure_vnf1_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_vnf1_instance
          target: vnf1_instance
        pre_configure_vnf2_instance:
          activities:
          - set_state: configuring
          on_success:
          - configure_vnf2_instance
          target: vnf2_instance
        start_cnf_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: cnf_instance
        start_sap_data:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: sap_data
        start_sap_mgmt:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: sap_mgmt
        start_vl_data_network:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          on_success:
          - create_vnf2_instance
          - create_cnf_instance
          - create_sap_data
          target: vl_data_network
        start_vl_mgmt_network:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          on_success:
          - create_vnf1_instance
          - create_vnf2_instance
          - create_cnf_instance
          - create_sap_mgmt
          target: vl_mgmt_network
        start_vnf1_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: vnf1_instance
        start_vnf2_instance:
          activities:
          - set_state: starting
          - call_operation: Standard.start
          - set_state: started
          target: vnf2_instance
    parallel_undeploy:
      description: Parallel undeployment declarative workflow
      steps:
        delete_cnf_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          - stop_vl_mgmt_network
          target: cnf_instance
        delete_sap_data:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          target: sap_data
        delete_sap_mgmt:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_mgmt_network
          target: sap_mgmt
        delete_vl_data_network:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          target: vl_data_network
        delete_vl_mgmt_network:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          target: vl_mgmt_network
        delete_vnf1_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_mgmt_network
          target: vnf1_instance
        delete_vnf2_instance:
          activities:
          - set_state: deleting
          - call_operation: Standard.delete
          - set_state: initial
          on_success:
          - stop_vl_data_network
          - stop_vl_mgmt_network
          target: vnf2_instance
        stop_cnf_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_cnf_instance
          target: cnf_instance
        stop_sap_data:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_sap_data
          target: sap_data
        stop_sap_mgmt:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_sap_mgmt
          target: sap_mgmt
        stop_vl_data_network:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vl_data_network
          target: vl_data_network
        stop_vl_mgmt_network:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vl_mgmt_network
          target: vl_mgmt_network
        stop_vnf1_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vnf1_instance
          target: vnf1_instance
        stop_vnf2_instance:
          activities:
          - set_state: stopping
          - call_operation: Standard.stop
          - set_state: stopped
          on_success:
          - delete_vnf2_instance
          target: vnf2_instance
tosca_definitions_version: tosca_simple_yaml_1_3
