tosca_definitions_version: tosca_simple_yaml_1_3

description: Network Service Descriptor (Final Version)

imports:
  - etsi_nfv_sol001_nsd_types.yaml
  - VNF1-scalable.yaml
  - VNF2-scalable.yaml
  - CNF3-scalable.yaml

topology_template:
  node_templates:
    # ========================================
    # Virtual Links
    # ========================================
    vl_mgmt_network:
      type: tosca.nodes.nfv.NsVirtualLink
      properties:
        connectivity_type:
          layer_protocols: [ipv4]
          flow_pattern: mesh
        vl_profile:
          max_bitrate_requirements: { root: 1000000 }
          min_bitrate_requirements: { root: 100000 }

    vl_data_network:
      type: tosca.nodes.nfv.NsVirtualLink
      properties:
        connectivity_type:
          layer_protocols: [ipv4]
          flow_pattern: line
        vl_profile:
          max_bitrate_requirements: { root: 10000000 }
          min_bitrate_requirements: { root: 1000000 }

    # ========================================
    # VNF/CNF Instances (Noms de Types Corrigés)
    # ========================================
    vnf1_instance:
      type: tosca.nodes.nfv.Firewall_VNF # Corrigé selon vos logs
      properties:
        flavour_id: scalable_ha
      requirements:
        - virtual_link: vl_mgmt_network

    vnf2_instance:
      type: tosca.nodes.nfv.IDS_VNF # Corrigé selon vos logs
      properties:
        flavour_id: scalable_ha
      requirements:
        - virtual_link: vl_data_network

    cnf_instance:
      type: tosca.nodes.nfv.Proxy_CNF # Corrigé selon vos logs
      properties:
        flavour_id: scalable_ha_container
      requirements:
        - virtual_link: vl_data_network

    # ========================================
    # Service Access Points (SAPs)
    # ========================================
    sap_mgmt:
      type: tosca.nodes.nfv.Sap
      properties:
        layer_protocols: [ipv4]
        role: root
      requirements:
        - internal_virtual_link: vl_mgmt_network

    sap_data:
      type: tosca.nodes.nfv.Sap
      properties:
        layer_protocols: [ipv4]
        role: root
      requirements:
        - internal_virtual_link: vl_data_network

# ========================================
  # Policies - REMPLACER CETTE SECTION
  # ========================================
  policies:
    # 1. Niveaux de déploiement
    - ns_instantiation_levels:
        type: tosca.policies.nfv.NsInstantiationLevels
        properties:
          ns_levels:
            small:
              description: "Déploiement minimal"
            medium:
              description: "Déploiement moyen"
            large:
              description: "Déploiement haute performance"
          default_level: small
    
    # 2. Mapping VNF1 - Format corrigé
    - vnf1_mapping:
        type: tosca.policies.nfv.VnfToLevelMapping
        targets: [ vnf1_instance ]
        properties:
          aspect: ns_scaling_aspect
          number_of_instances:
            small: 1
            medium: 2
            large: 3
    
    # 3. Mapping VNF2
    - vnf2_mapping:
        type: tosca.policies.nfv.VnfToLevelMapping
        targets: [ vnf2_instance ]
        properties:
          aspect: ns_scaling_aspect
          number_of_instances:
            small: 1
            medium: 2
            large: 3
    
    # 4. Mapping CNF
    - cnf_mapping:
        type: tosca.policies.nfv.VnfToLevelMapping
        targets: [ cnf_instance ]
        properties:
          aspect: ns_scaling_aspect
          number_of_instances:
            small: 1
            medium: 2
            large: 3
    
    # 5. Aspects de Scaling
    - ns_scaling_aspects:
        type: tosca.policies.nfv.NsScalingAspects
        properties:
          aspects:
            ns_scaling_aspect:
              name: ns_scaling_aspect
              description: "Scaling horizontal"
              ns_scale_levels:
                0:
                  description: "Base"
                1:
                  description: "Niveau 1"
                2:
                  description: "Niveau 2"
                3:
                  description: "Maximum"
